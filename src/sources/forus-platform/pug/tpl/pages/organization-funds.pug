.app.app-container
    menu
    section.app.app-content
        .card
            .card-header: .flex-row
                //- Organization funds title
                .flex.flex-grow: .card-title
                    span(i18n="components.organization_funds.title") 
                    span(ng-bind="$ctrl.funds.meta.total").span-count

                //- Filters
                .flex: .block.block-inline-filters
                    .button.button-default.button-sm(
                        ng-if="$ctrl.organization.allow_2fa_restrictions && ($ctrl.organization | hasPerm:['manage_organization'])"
                        ui-sref="organization-security({organization_id: $ctrl.organization.id, view_type: 'funds'})")
                        em.mdi.mdi-security.icon-start
                        translate(translate="components.organization_funds.buttons.security")

                    .button.button-primary.button-sm(
                        ng-if='$root.activeOrganization | hasPerm:["manage_funds"]'
                        ui-sref="funds-create({organization_id: $root.activeOrganization.id})"
                        id="create_fund")
                        em.mdi.mdi-plus-circle.icon-start
                        translate(translate="components.organization_funds.buttons.add")
                    
                    //- View type
                    .flex: .flex-row
                        .flex-col: .block.block-label-tabs: .label-tab-set 
                            .label-tab.label-tab-sm(
                                ng-class="{'active' : $ctrl.shownFundsType == 'active'}"
                                ui-sref="organization-funds({funds_type: 'active'})")
                                | Lopend ({{ $ctrl.funds.meta.unarchived_funds_total }})

                            .label-tab.label-tab-sm(
                                ng-class="{'active' : $ctrl.shownFundsType == 'archived'}"
                                ui-sref="organization-funds({funds_type: 'archived'})")
                                | Archief ({{ $ctrl.funds.meta.archived_funds_total }})    

                        .button.button-text(ng-if="$ctrl.filters.show" ng-click="$ctrl.filters.reset()")
                            em.mdi.mdi-close.icon-start
                            span(i18n="Wis filters")

                        .form(ng-if="!$ctrl.filters.show")
                            .form-group.inline-filters-search: input(
                                ng-model="$ctrl.filters.values.q"
                                placeholder="Zoeken").form-control

                        .inline-filters-dropdown.pull-right(click-outside="$ctrl.hideFilters()")
                            .inline-filters-dropdown-content(ng-show="$ctrl.filters.show")
                                .arrow-box.bg-dim: .arrow
                                .form
                                    .form-group
                                        form-label-toggle(label="{{ 'components.organization_funds.filters.search' | i18n }}" is-active)
                                        input(
                                            type="text"
                                            ng-model="$ctrl.filters.values.q"
                                            placeholder="{{ 'components.organization_funds.filters.search' | i18n }}").form-control
                                    
                                    .form-group(ng-click="$event.stopPropagation()")
                                        form-label-toggle(label="{{ 'components.organization_funds.filters.state' | translate }}")
                                        
                                        .form-offset: select-control(
                                            prop="key"
                                            search="false"
                                            ng-model="$ctrl.filters.values.state"
                                            options="$ctrl.states").form-control
                        
                            .button.button-default.button-icon(ng-click="$ctrl.filters.show = !$ctrl.filters.show"): em.mdi.mdi-filter-outline

            //- Funds list
            .card-section(ng-if="$ctrl.funds.meta.total > 0")
                .card-block.card-block-table
                    .table-wrapper
                        table.table
                            tr
                                th(translate="components.organization_funds.labels.name" value="name")
                                th(translate="components.organization_funds.labels.remaining" value="remaining_amount")
                                th(translate="components.organization_funds.labels.requester_count" value="requester_count")
                                th(translate="components.organization_funds.labels.status" value="state")
                                th(translate="components.organization_funds.labels.actions").th-narrow.text-right

                            tr(ng-repeat="fund in $ctrl.funds.data")
                                td(ng-bind="fund.name | str_limit:25" title="{{ fund.name || '-' }}")

                                td.text-primary-light: span(ng-if="!fund.archived" ng-bind="fund.budget.total - fund.budget.used | currency_format")

                                td: strong(ng-if="!fund.archived" ng-bind="fund.requester_count").text-strong.text-md.text-muted-dark

                                td
                                    .tag.tag-sm.tag-success(ng-if="!fund.archived && fund.state == 'active'" ng-bind="fund.state")
                                    .tag.tag-warning.tag-sm(ng-if="!fund.archived && fund.state == 'paused'" translate="components.organization_funds.states.paused")
                                    .tag.tag-default.tag-sm(ng-if="!fund.archived && fund.state == 'closed'" translate="components.organization_funds.states.closed")
                                    .tag.tag-default.tag-sm(ng-if="fund.archived" translate="components.organization_funds.states.archived")

                                td.td-narrow.text-right
                                    button.button.button-icon.button-text.button-menu.active(
                                        ng-if="!fund.archived"
                                        type="button" 
                                        ng-click="$ctrl.toggleActions($event, fund)")
                                        em.mdi.mdi-dots-horizontal

                                        .menu-dropdown(
                                            click-outside="$ctrl.onClickOutsideMenu($event, fund)" 
                                            ng-if="fund.showMenu")

                                            .menu-dropdown-arrow
                                            .dropdown.dropdown-actions
                                                a(
                                                    target="_blank" 
                                                    ui-sref="funds-show(fund)").dropdown-item
                                                    | #[em.mdi.mdi-eye.icon-start] Bekijken
                                                
                                                a(
                                                    ng-if="fund.balance_provider == 'top_ups' && fund.key && fund.state != 'closed'"
                                                    ng-disabled="!fund.organization.has_bank_connection"
                                                    ng-click="$ctrl.topUpModal(fund)").dropdown-item
                                                    | #[em.mdi.mdi-plus-circle.icon-start] Budget toevoegen

                                                a(
                                                    ng-if="fund.organization | hasPerm:['manage_funds','manage_fund_texts']:false"
                                                    ui-sref="funds-edit(fund)").dropdown-item
                                                    | #[em.mdi.mdi-pencil.icon-start] Bewerken

                                                a(
                                                    ng-if="$ctrl.organization.allow_2fa_restrictions && ($ctrl.organization | hasPerm:['manage_organization'])"
                                                    ui-sref="organization-security({organization_id: $ctrl.organization.id, view_type: 'funds'})").dropdown-item
                                                    | #[em.mdi.mdi-security.icon-start] Beveiliging

                                                a(
                                                    ng-if="fund.key && fund.state == 'closed'" 
                                                    ng-click="$ctrl.archiveFund(fund)").dropdown-item
                                                    | #[em.mdi.mdi-download-box-outline.icon-start]
                                                    translate(translate="components.organization_funds.buttons.archive")

                                    .button.button-primary(
                                        ng-if="fund.archived && (fund.organization | hasPerm:'manage_funds')" 
                                        ng-click="$ctrl.restoreFund(fund)")
                                        em.mdi.mdi-lock-reset.icon-start
                                        translate(translate="components.organization_funds.buttons.restore")

            //- Funds pagination
            .card-section(ng-if="$ctrl.funds" ng-show="$ctrl.funds.meta.last_page > 1")
                paginator(
                    meta="$ctrl.funds.meta" 
                    filters="$ctrl.filters.values"
                    on-page-change="$ctrl.onPageChange(query)")

            //- Empty transactions block
            .card-section(ng-if="$ctrl.funds.meta.total == 0"): .block.block-empty.text-center
                .empty-title Geen fondsen gevonden