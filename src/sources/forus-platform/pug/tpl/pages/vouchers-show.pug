.app.app-container(ng-if="$root.activeOrganization && $root.auth_user")
    menu
    section.app.app-content
        //- Navigation
        .block.block-breadcrumbs(ng-if="$root.activeOrganization")
            .breadcrumb-item(
                ui-sref="vouchers({organization_id:$root.activeOrganization.id})" 
                ng-bind="'Vouchers'"
                ng-if="!$ctrl.voucher.product")

            .breadcrumb-item(
                ui-sref="product-vouchers({organization_id:$root.activeOrganization.id})" 
                ng-bind="'Aanbiedingsvouchers'"
                ng-if="$ctrl.voucher.product")

            .breadcrumb-item(
                ng-if="$ctrl.appConfigs.panel_type == 'sponsor'"
                ui-sref="vouchers({organization_id:$root.activeOrganization.id})" 
                ng-bind="$ctrl.voucher.fund.name")

            .breadcrumb-item.active(ng-bind="$ctrl.voucher.fund.name + ' #' + $ctrl.voucher.id")

        //- Base voucher details
        .card(ng-if="$ctrl.voucher")
            .card-header: .flex
                .flex.flex-grow: .card-title
                    //- voucher fund or product name
                    .flex.flex-vertical.flex-center(ng-bind="$ctrl.voucher.fund.name" ng-if="!$ctrl.voucher.product") 
                    .flex.flex-vertical.flex-center(ng-bind="$ctrl.voucher.product.name" ng-if="$ctrl.voucher.product")

                    //- is active
                    .flex.flex-vertical.flex-center: .tag.tag-success.tag-sm(
                        ng-if="!$ctrl.voucher.expired && $ctrl.voucher.state == 'active'" 
                        ng-bind="$ctrl.voucher.state_locale")

                    //- is pending
                    .flex.flex-vertical.flex-center: .tag.tag-default.tag-sm(
                        ng-if="!$ctrl.voucher.expired && $ctrl.voucher.state == 'pending'"
                        ng-bind="$ctrl.voucher.state_locale")

                    //- is deactivated
                    .flex.flex-vertical.flex-center: .tag.tag-danger.tag-sm(
                        ng-if="!$ctrl.voucher.expired && $ctrl.voucher.state == 'deactivated'" 
                        ng-bind="$ctrl.voucher.state_locale")

                    //- is expired
                    .flex.flex-vertical.flex-center: .tag.tag-warning.tag-sm(
                        ng-if="$ctrl.voucher.expired" 
                        translate="vouchers.labels.expired")

                    | &nbsp;&nbsp;

                    //- voucher product (product vouchers only)
                    span.text-primary(
                        ng-if="$ctrl.voucher.product"
                        ng-bind="$ctrl.voucher.product.organization.name")

                    //- voucher amount (budget funds only)
                    span.text-primary(
                        ng-if="$ctrl.voucher.fund.type == 'budget' && !$ctrl.voucher.product" 
                        ng-bind="$ctrl.voucher.amount_total | currency_format")

                //- voucher actions
                .flex.flex-self-start: .flex-row: .button-group
                    .button.button-default.button-sm(
                        ng-if="$ctrl.showMakeTransactionButton && $ctrl.fund.allow_voucher_top_ups"
                        ng-click="$ctrl.makeTopUpTransaction()")
                        em.mdi.mdi-cash-plus.icon-start
                        string(translate="vouchers.buttons.make_top_up_transaction")

                    //- is granted?
                    .button.button-primary.button-sm(
                        ng-if="$ctrl.showMakeTransactionButton"
                        ng-click="$ctrl.makeTransaction()")
                        em.mdi.mdi-cash-fast.icon-start
                        string(translate="vouchers.buttons.make_transaction")

                    //- deactivate voucher
                    .button.button-danger.button-sm(
                        ng-if="!$ctrl.voucher.expired && $ctrl.voucher.state === 'active'"
                        ng-click="$ctrl.deactivateVoucher()")
                        em.mdi.mdi-close.icon-start
                        | Deactiveren

                    //- reactivate voucher
                    .button.button-danger.button-sm(
                        ng-if="!$ctrl.voucher.expired && $ctrl.voucher.state === 'deactivated'"
                        ng-click="$ctrl.activateVoucher()")
                        em.mdi.mdi-alert-outline.icon-start
                        | Activeren

                    //- make physical card request
                    .button.button-default.button-sm(
                        ng-if="$ctrl.physicalCardsAvailable && !$ctrl.voucher.expired"
                        ng-click="$ctrl.orderPhysicalCard()")
                        em.mdi.mdi-card-text-outline.icon-start
                        | Plastic pas bestellen 

                    //- attach physical card
                    .button.button-default.button-sm(
                        ng-if="$ctrl.physicalCardsAvailable && !$ctrl.voucher.physical_card"
                        ng-click="$ctrl.addPhysicalCard()")
                        em.mdi.mdi-ticket-account.icon-start 
                        span(translate="vouchers.buttons.physical_card_add")

                    //- remove physical card
                    .button.button-default.button-sm(
                        ng-if="$ctrl.physicalCardsAvailable && $ctrl.voucher.physical_card"
                        ng-click="$ctrl.deletePhysicalCard()")
                        em.mdi.mdi-ticket-account.icon-start 
                        span(translate="vouchers.buttons.physical_card_delete")

                    .button.button-primary.button-sm(
                        ng-if="!$ctrl.fundClosed && !$ctrl.voucher.expired && !$ctrl.voucher.is_granted  && $ctrl.voucher.state === 'pending'"
                        ng-click="$ctrl.showQrCode()")
                        em.mdi.mdi-clipboard-account.icon-start 
                        span(translate="vouchers.buttons.activate")

                    .button.button-primary.button-sm(
                        ng-if="!$ctrl.fundClosed && !$ctrl.voucher.is_granted && !$ctrl.voucher.expired && $ctrl.voucher.state === 'active'"
                        ng-click="$ctrl.showQrCode()")
                        em.mdi.mdi-qrcode.icon-start 
                        string(translate="vouchers.labels.qr_code")

            .card-section
                .card-block.card-block-table
                    .table-wrapper
                        table.table
                            tr
                                td
                                    strong(translate="vouchers.labels.email").text-strong.text-md.text-muted-dark
                                    br
                                    strong.text-black(ng-bind="$ctrl.voucher.identity_email || 'Niet toegewezen'")

                                td(ng-if="$ctrl.voucher.identity_bsn || $ctrl.voucher.relation_bsn")
                                    strong(translate="vouchers.labels.bsn").text-strong.text-md.text-muted-dark
                                    br
                                    strong(ng-bind="($ctrl.voucher.identity_bsn || $ctrl.voucher.relation_bsn)").text-black

                                td(ng-if="$ctrl.voucher.physical_card")
                                    strong(translate="vouchers.labels.physical_card").text-strong.text-md.text-muted-dark
                                    br
                                    strong(ng-bind="$ctrl.voucher.physical_card.code").text-black

                                td(ng-if="$ctrl.voucher.activation_code")
                                    strong(translate="vouchers.labels.details_activation_code").text-strong.text-md.text-muted-dark
                                    br
                                    strong(ng-bind="$ctrl.voucher.activation_code").text-black

                                td(ng-if="$ctrl.voucher.activation_code_uid")
                                    strong(translate="vouchers.labels.uid").text-strong.text-md.text-muted-dark
                                    br
                                    strong(ng-bind="$ctrl.voucher.activation_code_uid").text-black

                                td(ng-if="$ctrl.voucher.fund.type == 'subsidies'")
                                    strong(translate="vouchers.labels.limit_multiplier").text-strong.text-md.text-muted-dark
                                    br
                                    strong(ng-bind="$ctrl.voucher.limit_multiplier").text-black
                                    | &nbsp;&nbsp;
                                    .button.button-default.button-sm(ng-click="$ctrl.incrementLimitMultiplier()")
                                        em.mdi.mdi-plus-circle.icon-start
                                        | Nieuwe toevoegen

                                td(ng-if="$ctrl.voucher.fund.type != 'subsidies'")
                                td(ng-if="!($ctrl.voucher.identity_bsn || $ctrl.voucher.relation_bsn)")
                                td(ng-if="!$ctrl.voucher.physical_card")

                            tr
                                td(ng-if="!$ctrl.fundClosed")
                                    strong(translate="vouchers.labels.expire_date").text-strong.text-md.text-muted-dark
                                    br
                                    strong(ng-bind="$ctrl.voucher.expire_at_locale").text-black

                                td(ng-if="!$ctrl.fundClosed")
                                    strong(translate="vouchers.labels.created_date").text-strong.text-md.text-muted-dark
                                    br
                                    strong(ng-bind="$ctrl.voucher.created_at_locale.split(' - ')[1]").text-black    

                                td 
                                    strong(translate="vouchers.labels.source").text-strong.text-md.text-muted-dark
                                    br
                                    strong(ng-bind="'vouchers.labels.source_' + $ctrl.voucher.source | translate").text-black

                                td(ng-if="!$ctrl.fundClosed && !$ctrl.voucher.in_use")
                                    strong(translate="vouchers.labels.used").text-strong.text-md.text-muted-dark
                                    br
                                    em.mdi.mdi-close.text-black
                                    strong(translate="product_vouchers.labels.no").text-black

                                td(ng-if="!$ctrl.fundClosed && $ctrl.voucher.in_use")
                                    strong(translate="vouchers.labels.used").text-strong.text-md.text-muted-dark
                                    br
                                    em.mdi.mdi-check.text-black
                                    strong(translate="product_vouchers.labels.yes").text-black

                            tr(ng-if="!$ctrl.voucher.product")
                                td
                                    strong.text-strong.text-md.text-muted-dark Totaal toegekend
                                    br
                                    strong(ng-bind="$ctrl.voucher.amount_total | currency_format").text-black

                                td
                                    strong.text-strong.text-md.text-muted-dark Initieel toegekend
                                    br
                                    strong(ng-bind="$ctrl.voucher.amount | currency_format").text-black

                                td
                                    strong.text-strong.text-md.text-muted-dark Totaal opgewaardeerd
                                    br
                                    strong(ng-bind="$ctrl.voucher.amount_top_up | currency_format").text-black

                                td
                                    strong.text-strong.text-md.text-muted-dark Huidig bedrag
                                    br
                                    strong(ng-bind="$ctrl.voucher.amount_available | currency_format").text-black

        //- Voucher history
        event-logs(
            ng-if="$ctrl.voucher"
            organization="$ctrl.organization"
            filter-values="$ctrl.eventFilters"
            hide-filter-form="true"
            hide-entity="true"
            register="$ctrl.registerLogsDirective(directive)"
            block-title="Geschiedenis")

        //- Voucher sponsor note set upon creation
        .card(ng-if="$ctrl.voucher.note")
            .card-header: .card-title(translate="vouchers.labels.note")
            .card-section: .card-text(ng-bind="$ctrl.voucher.note")

        //- Voucher transactions
        voucher-transactions(
            ng-if="$ctrl.voucher"
            organization="$ctrl.organization"
            filter-values="$ctrl.transactionsFilters"
            register="$ctrl.registerTransactionsDirective(directive)"
            block-title="Transacties")
